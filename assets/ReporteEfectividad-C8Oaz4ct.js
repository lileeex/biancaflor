import{r as n,j as e}from"./index-DnIkRolS.js";import{G as r}from"./Grid-IelTXcD1.js";import{T as s}from"./Typography-CfsH5zdM.js";import{P,a as f}from"./Button-BpD1F6SI.js";import{A as B}from"./Alert-CTdHQ_EP.js";import{f as l}from"./TextField-CfisxxK2.js";import{M}from"./MenuItem-Dl1BH1Ob.js";import"./useForkRef-_vsIMq9w.js";import"./useSlot-CCO6SuW7.js";import"./IconButton-7CARgz9E.js";import"./Portal-7hzC-RGP.js";import"./listItemTextClasses-B0jihKPi.js";import"./dividerClasses-CbI3AfZu.js";const u=a=>typeof a=="string"?a:"",ee=()=>{var G;const[a,p]=n.useState([]),[b,I]=n.useState([]),[L,A]=n.useState([]),[m,E]=n.useState(!1),[C,x]=n.useState(""),[t,c]=n.useState({codigo:"",codigoLote:"",saborGelato:"",litrosAProducir:"",litrosProducidos:"",efectividad:"",fecha:""});n.useEffect(()=>{p(JSON.parse(localStorage.getItem("reporteEfectividad")||"[]")),I(JSON.parse(localStorage.getItem("lotes")||"[]")),A(JSON.parse(localStorage.getItem("sabores")||"[]"))},[]),n.useEffect(()=>{if(t.codigoLote){const o=b.find(i=>i.codigoLote===t.codigoLote);o&&c(i=>({...i,saborGelato:o.saborGelato}))}},[t.codigoLote,b]);const g=o=>{c({...t,[o.target.name]:o.target.value})},W=()=>{const o=parseFloat(t.litrosAProducir),i=parseFloat(t.litrosProducidos);if(!isNaN(o)&&o>0&&!isNaN(i)){const d=(i/o*100).toFixed(2)+"%";c({...t,efectividad:d})}else c({...t,efectividad:""})},F=()=>{x("");const{codigo:o,codigoLote:i,saborGelato:d,litrosAProducir:y,litrosProducidos:j,efectividad:h,fecha:$}=t;if(!o||!i||!d||!y||!j||!h||!$){x("Completa todos los campos.");return}if(m){const S=a.map(R=>R.codigo===o?{...t}:R);p(S),localStorage.setItem("reporteEfectividad",JSON.stringify(S)),v();return}if(a.some(S=>S.codigo===o)){x("No se pueden registrar dos reportes con el mismo código.");return}const w={...t},N=[...a,w];p(N),localStorage.setItem("reporteEfectividad",JSON.stringify(N)),v()},k=o=>{c({...o}),E(!0),x("")},O=o=>{const i=a.filter(d=>d.codigo!==o);p(i),localStorage.setItem("reporteEfectividad",JSON.stringify(i)),v()},v=()=>{c({codigo:"",codigoLote:"",saborGelato:"",litrosAProducir:"",litrosProducidos:"",efectividad:"",fecha:""}),E(!1),x("")},J=t.saborGelato?((G=L.find(o=>o.codigoSabor===t.saborGelato))==null?void 0:G.nombreSabor)||t.saborGelato:"";return e.jsxs(r,{container:!0,spacing:3,sx:{padding:3},children:[e.jsx(r,{item:!0,xs:12,children:e.jsx(s,{variant:"h4",gutterBottom:!0,sx:{textAlign:"center",fontWeight:"bold"},children:"Reporte de Efectividad"})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(P,{sx:{padding:3,borderRadius:2,boxShadow:3},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,sx:{color:"#00796b",fontWeight:"bold"},children:m?"Modificar Reporte":"Registrar Reporte"}),C&&e.jsx(B,{severity:"error",sx:{mb:2},children:C}),e.jsx("form",{onSubmit:o=>{o.preventDefault(),F()},children:e.jsxs(r,{container:!0,spacing:2,children:[e.jsx(r,{item:!0,xs:12,md:4,children:e.jsx(l,{label:"Código",name:"codigo",variant:"outlined",fullWidth:!0,value:t.codigo,onChange:g,disabled:m})}),e.jsx(r,{item:!0,xs:12,md:4,children:e.jsx(l,{select:!0,label:"Nº de Lote",name:"codigoLote",variant:"outlined",fullWidth:!0,value:t.codigoLote,onChange:g,children:b.map(o=>e.jsx(M,{value:o.codigoLote,children:o.codigoLote},o.codigoLote))})}),t.saborGelato&&e.jsx(r,{item:!0,xs:12,md:4,children:e.jsxs(s,{variant:"body1",sx:{mt:2},children:[e.jsx("b",{children:"Sabor Gelato:"})," ",J]})}),e.jsx(r,{item:!0,xs:12,md:4,children:e.jsx(l,{label:"Litros a Producir",name:"litrosAProducir",type:"number",variant:"outlined",fullWidth:!0,value:t.litrosAProducir,onChange:g,inputProps:{min:0}})}),e.jsx(r,{item:!0,xs:12,md:4,children:e.jsx(l,{label:"Litros Producidos",name:"litrosProducidos",type:"number",variant:"outlined",fullWidth:!0,value:t.litrosProducidos,onChange:g,inputProps:{min:0}})}),e.jsx(r,{item:!0,xs:12,md:4,children:e.jsx(l,{label:"Efectividad",name:"efectividad",variant:"outlined",fullWidth:!0,value:t.efectividad,InputProps:{readOnly:!0}})}),e.jsx(r,{item:!0,xs:12,md:4,children:e.jsx(l,{label:"Fecha",name:"fecha",type:"date",variant:"outlined",fullWidth:!0,value:t.fecha,onChange:g,InputLabelProps:{shrink:!0}})}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx(f,{variant:"contained",color:"primary",type:"submit",fullWidth:!0,sx:{backgroundColor:"#00796b","&:hover":{backgroundColor:"#004d40"},borderRadius:2,padding:"12px"},children:m?"Modificar Reporte":"Registrar Reporte"}),e.jsx(f,{variant:"outlined",color:"secondary",onClick:W,fullWidth:!0,sx:{mt:1},children:"Generar Efectividad"}),m&&e.jsx(f,{variant:"outlined",color:"secondary",onClick:v,fullWidth:!0,sx:{mt:1},children:"Cancelar"})]})]})})]})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(P,{sx:{padding:3,borderRadius:2,boxShadow:3},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,sx:{color:"#00796b",fontWeight:"bold",mb:4},children:"Reportes de Efectividad Registrados"}),e.jsx(r,{container:!0,spacing:2,children:a.length===0?e.jsx(s,{variant:"body1",sx:{width:"100%",mb:6},children:"No hay reportes de efectividad registrados."}):a.map((o,i)=>{var j;const d=b.find(h=>h.codigoLote===o.codigoLote),y=d?((j=L.find(h=>h.codigoSabor===d.saborGelato))==null?void 0:j.nombreSabor)||d.saborGelato:"";return e.jsx(r,{item:!0,xs:12,children:e.jsxs(P,{sx:{padding:2,marginBottom:2,borderRadius:2,boxShadow:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx(s,{variant:"body1",children:`Nº de Lote: ${u(o.codigoLote)}`}),e.jsx(s,{variant:"body1",children:`Sabor Gelato: ${y}`}),e.jsx(s,{variant:"body1",children:`Litros a Producir: ${u(o.litrosAProducir)}`}),e.jsx(s,{variant:"body1",children:`Litros Producidos: ${u(o.litrosProducidos)}`}),e.jsx(s,{variant:"body1",children:`Efectividad: ${u(o.efectividad)}`}),e.jsx(s,{variant:"body1",children:`Fecha: ${u(o.fecha)}`})]}),e.jsxs("div",{children:[e.jsx(f,{color:"primary",onClick:()=>k(o),sx:{marginRight:1},children:"Modificar"}),e.jsx(f,{color:"error",onClick:()=>O(u(o.codigo)),children:"Eliminar"})]})]})},i)})})]})})]})};export{ee as default};

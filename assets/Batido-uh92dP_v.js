import{r as s,j as e}from"./index-DnIkRolS.js";import{G as r}from"./Grid-IelTXcD1.js";import{T as a}from"./Typography-CfsH5zdM.js";import{P as I,a as S}from"./Button-BpD1F6SI.js";import{A as U}from"./Alert-CTdHQ_EP.js";import{f as v}from"./TextField-CfisxxK2.js";import"./useForkRef-_vsIMq9w.js";import"./useSlot-CCO6SuW7.js";import"./IconButton-7CARgz9E.js";import"./Portal-7hzC-RGP.js";const ae=()=>{var O,G;const[l,B]=s.useState(""),[c,y]=s.useState(""),[m,L]=s.useState(""),[b,C]=s.useState(""),[u,p]=s.useState([]),[E,F]=s.useState([]),[N,$]=s.useState([]),[R,w]=s.useState([]),[P,z]=s.useState([]),[n,x]=s.useState(null),[g,W]=s.useState(!1),[J,d]=s.useState("");s.useEffect(()=>{p(JSON.parse(localStorage.getItem("batidos")||"[]")),F(JSON.parse(localStorage.getItem("pesados")||"[]")),$(JSON.parse(localStorage.getItem("lotes")||"[]")),w(JSON.parse(localStorage.getItem("heladeros")||"[]")),z(JSON.parse(localStorage.getItem("sabores")||"[]"))},[]);const H=()=>{d("");const o=N.find(t=>t.codigoLote===c);if(!o){x(null),d("No existe el lote. Regístrelo primero.");return}if(!E.some(t=>t.codigoLote===c)){x(null),d("Debe existir un Pesado para este lote antes de registrar el Batido.");return}x(o)},M=()=>{if(d(""),!l||!c||!m||!b){d("Completa todos los campos.");return}if(g){const t=u.map(j=>j.codigoBatido===l?{codigoBatido:l,codigoLote:c,fecha:m,litros:b}:j);p(t),localStorage.setItem("batidos",JSON.stringify(t)),f();return}if(u.some(t=>t.codigoBatido===l)){d("No se pueden registrar dos batidos con el mismo código.");return}const o={codigoBatido:l,codigoLote:c,fecha:m,litros:b},i=[...u,o];p(i),localStorage.setItem("batidos",JSON.stringify(i)),f()},T=o=>{B(o.codigoBatido),y(o.codigoLote),L(o.fecha),C(o.litros),x(N.find(i=>i.codigoLote===o.codigoLote)||null),W(!0),d("")},D=o=>{const i=u.filter(t=>t.codigoBatido!==o);p(i),localStorage.setItem("batidos",JSON.stringify(i)),f()},f=()=>{B(""),y(""),L(""),C(""),x(null),W(!1),d("")},q=n?((O=R.find(o=>o.codigo===n.heladero))==null?void 0:O.nombre)||n.heladero:"",K=n?((G=P.find(o=>o.codigoSabor===n.saborGelato))==null?void 0:G.nombreSabor)||n.saborGelato:"";return e.jsxs(r,{container:!0,spacing:3,sx:{padding:3},children:[e.jsx(r,{item:!0,xs:12,children:e.jsx(a,{variant:"h4",gutterBottom:!0,sx:{textAlign:"center",fontWeight:"bold"},children:"Gestionar Batido"})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(I,{sx:{padding:3,borderRadius:2,boxShadow:3},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,sx:{color:"#00796b",fontWeight:"bold"},children:g?"Modificar Batido":"Registrar Batido"}),J&&e.jsx(U,{severity:"error",sx:{mb:2},children:J}),e.jsx("form",{onSubmit:o=>{o.preventDefault(),M()},children:e.jsxs(r,{container:!0,spacing:2,children:[e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(v,{label:"Código del Batido",variant:"outlined",fullWidth:!0,value:l,onChange:o=>B(o.target.value),disabled:g})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(v,{label:"Código del Lote",variant:"outlined",fullWidth:!0,value:c,onChange:o=>y(o.target.value),onBlur:H,disabled:g})}),n&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:12,md:4,children:e.jsxs(a,{variant:"body1",children:[e.jsx("b",{children:"Heladero:"})," ",q]})}),e.jsx(r,{item:!0,xs:12,md:4,children:e.jsxs(a,{variant:"body1",children:[e.jsx("b",{children:"Sabor:"})," ",K]})})]}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(v,{label:"Fecha de Batido",variant:"outlined",type:"date",fullWidth:!0,value:m,onChange:o=>L(o.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(v,{label:"Litros Producidos",variant:"outlined",type:"number",fullWidth:!0,value:b,onChange:o=>C(o.target.value)})}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx(S,{variant:"contained",color:"primary",type:"submit",fullWidth:!0,sx:{backgroundColor:"#00796b","&:hover":{backgroundColor:"#004d40"},borderRadius:2,padding:"12px"},children:g?"Modificar Batido":"Registrar Batido"}),g&&e.jsx(S,{variant:"outlined",color:"secondary",onClick:f,fullWidth:!0,sx:{mt:1},children:"Cancelar"})]})]})})]})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(I,{sx:{padding:3,borderRadius:2,boxShadow:3},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,sx:{color:"#00796b",fontWeight:"bold",mb:4},children:"Batidos Registrados"}),e.jsx(r,{container:!0,spacing:2,children:u.length===0?e.jsx(a,{variant:"body1",sx:{width:"100%",mb:6},children:"No hay batidos registrados."}):u.map((o,i)=>{var k,A;const t=N.find(h=>h.codigoLote===o.codigoLote),j=t?((k=R.find(h=>h.codigo===t.heladero))==null?void 0:k.nombre)||t.heladero:"",Q=t?((A=P.find(h=>h.codigoSabor===t.saborGelato))==null?void 0:A.nombreSabor)||t.saborGelato:"";return e.jsx(r,{item:!0,xs:12,children:e.jsxs(I,{sx:{padding:2,marginBottom:2,borderRadius:2,boxShadow:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx(a,{variant:"body1",children:`Código de Batido: ${o.codigoBatido}`}),e.jsx(a,{variant:"body1",children:`Código de Lote: ${o.codigoLote}`}),e.jsx(a,{variant:"body1",children:`Heladero: ${j}`}),e.jsx(a,{variant:"body1",children:`Sabor: ${Q}`}),e.jsx(a,{variant:"body1",children:`Fecha: ${o.fecha}`}),e.jsx(a,{variant:"body2",children:`Litros Producidos: ${o.litros} litros`})]}),e.jsxs("div",{children:[e.jsx(S,{color:"primary",onClick:()=>T(o),sx:{marginRight:1},children:"Modificar"}),e.jsx(S,{color:"error",onClick:()=>D(o.codigoBatido),children:"Eliminar"})]})]})},i)})})]})})]})};export{ae as default};
